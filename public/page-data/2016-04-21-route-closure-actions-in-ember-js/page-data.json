{"componentChunkName":"component---src-templates-blog-post-tsx","path":"/2016-04-21-route-closure-actions-in-ember-js/","result":{"data":{"site":{"siteMetadata":{"title":"no.lol","author":"Azmarie Wang"}},"markdownRemark":{"id":"3ef5df59-7359-586a-9f57-7e04c34c5916","excerpt":"In my previous post, I wrote about moving singleton state in Controllers into Services that back components. This means being able to lighten the responsibility…","html":"<p>In my <a href=\"https://emberway.io/ember-js-goodbye-mvc-part-1-21777ecfd708#.cigfu5es3\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">previous post</a>, I wrote about moving singleton state in Controllers into Services that back components. This means being able to lighten the responsibility of Controllers in your application, and in some cases even remove them completely. However, a common pain point that remains for many is that it isn’t really clear what <em>should live</em> on a Controller, if anything.</p>\n<p>(No, they’re not)</p>\n<p><a href=\"https://twitter.com/locks\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Locks</a> has written an excellent <a href=\"https://locks.svbtle.com/controllers-are-dead-long-life-controllers\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">blog post</a> on this sometimes controversial topic, and I expanded upon it a little in my <a href=\"https://emberweekend.com/episodes/like-stealing-candy-from-a-baby\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">podcast episode</a> with Ember Weekend. <a href=\"https://twitter.com/erikch\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Erik Hanchett</a> also did a video demo showcasing what I mentioned:</p>\n<div class=\"gatsby-resp-iframe-wrapper\" style=\"padding-bottom: 56.25%; position: relative; height: 0; overflow: hidden; margin-bottom: 1.0725rem\" > <iframe src=\"https://www.youtube.com/embed/ovgDR2qAl-Q\" frameborder=\"0\" allow=\"accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture\" allowfullscreen=\"\" style=\" position: absolute; top: 0; left: 0; width: 100%; height: 100%; \"></iframe> </div>\n<p>Basically, you still require a Controller if you use query parameters, and in certain cases of bubbling actions.</p>\n<p>One reason that is commonly suggested as an argument for using Controllers is that when Routable Components land, it would be a simple rename from Controller to Component. However, if you’ve read my earlier post and listened to the podcast / watched the video above, you’ll know that Routable Components are stateless like ordinary Ember Components. Controllers, on the other hand, are stateful, which means that the transition won’t be so simple.</p>\n<p>That said, I wouldn’t go out of your way to creatively avoid using Controllers, and would <strong>only remove them if it makes sense to do so</strong>. You can ease the transition by extracting your stateful logic into a service, and leaving the stateless logic in your Controller (or Component).</p>\n<h4 id=\"sending-closure-actions-directly-to-the-route\" style=\"position:relative;\"><a href=\"#sending-closure-actions-directly-to-the-route\" aria-label=\"sending closure actions directly to the route permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Sending closure actions directly to the route</h4>\n<p><a href=\"https://dockyard.com/blog/2015/10/29/ember-best-practice-stop-bubbling-and-use-closure-actions\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Closure actions</a> are probably one of my favorite additions to Ember. Instead of casting string actions into the void and praying that something is listening, we can instead use an action like we would any other JavaScript function. This means that we can do useful things like curry arguments, utilize return values, and all of the other good stuff we expect from a regular JS function call.</p>\n<p>For example, the following action is implicit in that you have no idea where the action actually lives — it could be on a component, controller or route.</p>\n<div class=\"gatsby-highlight\" data-language=\"handlebars\"><pre class=\"language-handlebars\"><code class=\"language-handlebars\"><span class=\"token handlebars language-handlebars\"><span class=\"token comment\">{{! where does `myAction` live? }}</span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>button</span> <span class=\"token attr-name\"><span class=\"token handlebars language-handlebars\"><span class=\"token delimiter punctuation\">{{</span><span class=\"token variable\">action</span> <span class=\"token string\">\"myAction\"</span><span class=\"token delimiter punctuation\">}}</span></span></span><span class=\"token punctuation\">></span></span>Do it<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>button</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p>Unfortunately, Ember’s in a bit of an awkward transition phase right now. Without bringing in an addon (or making a custom helper), it’s not possible to use a closure action directly from the route — it would have to be defined on the Controller.</p>\n<p>If you wanted to remove Controllers from your application, then you would have to resort to using string based actions instead of closure actions. This seems like a lose-lose situation, so I worked together with <a href=\"https://twitter.com/rwjblue\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">rwjblue</a> to turn his <a href=\"http://jsbin.com/jipani/edit?html,js,output\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">jsbin spike</a> into a working addon.</p>\n<p><a href=\"https://github.com/dockyard/ember-route-action-helper\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">ember-route-action-helper</a> lets you use closure actions defined on the route in your templates, meaning that many Controllers that only exist to implement actions can now be removed. You can install it today with:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">ember install ember-route-action-helper</code></pre></div>\n<p>And to use it, you can just use <code class=\"language-text\">route-action</code> in place of <code class=\"language-text\">action</code> inside of your route’s template, like so:</p>\n<div class=\"gatsby-code-title\">foo/template.hbs</div>\n<div class=\"gatsby-highlight\" data-language=\"handlebars\"><pre class=\"language-handlebars\"><code class=\"language-handlebars\"><span class=\"token handlebars language-handlebars\"><span class=\"token delimiter punctuation\">{{</span><span class=\"token variable\">foo-bar</span> <span class=\"token variable\">click</span><span class=\"token punctuation\">=</span><span class=\"token punctuation\">(</span><span class=\"token variable\">route-action</span> <span class=\"token string\">\"updateFoo\"</span> <span class=\"token string\">\"Hello\"</span> <span class=\"token string\">\"world\"</span><span class=\"token punctuation\">)</span><span class=\"token delimiter punctuation\">}}</span></span></code></pre></div>\n<p>This addon gives you all the goodness of closure actions, and is a great way of taking steps to future proof your Ember application. When Routable Components do land, and actions work correctly, then upgrading your app simply becomes a search and replace for <code class=\"language-text\">s/route-action/action</code>.</p>\n<h4 id=\"power-up-your-handlebars-templates-with-helpers\" style=\"position:relative;\"><a href=\"#power-up-your-handlebars-templates-with-helpers\" aria-label=\"power up your handlebars templates with helpers permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Power up your Handlebars templates with Helpers</h4>\n<p>Helpers are a really nice way of extracting utility functions that you can use in your application. You can create class based Helpers, like ember-route-action-helper, or simple pure-function ones using <a href=\"http://emberjs.com/api/classes/Ember.Helper.html#method_helper\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Helper.helper</a> like the one used in <a href=\"https://github.com/poteto/ember-toggle-helper\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">ember-toggle-helper</a>.</p>\n<p>Pure-function helpers are simple to grok and understand, so a look at addons like <a href=\"https://github.com/jmurphyau/ember-truth-helpers\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">ember-truth-helpers</a> is sufficient to understand them.</p>\n<p>ember-route-action-helper uses the class based implementation, which must define a <code class=\"language-text\">compute</code> method. This is then invoked every time one of the positional arguments to the helper changes.</p>\n<p>Under the hood, the <code class=\"language-text\">route-action</code> helper retrieves the router from the application instance as a computed property, then locates the function reference from the currently active routes:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">getRouteWithAction</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">router<span class=\"token punctuation\">,</span> actionName</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">let</span> handler <span class=\"token operator\">=</span> <span class=\"token function\">emberArray</span><span class=\"token punctuation\">(</span><span class=\"token function\">getRoutes</span><span class=\"token punctuation\">(</span>router<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">find</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">route</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// find the route with the action</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span> action<span class=\"token punctuation\">,</span> handler <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>The action and the handler (route) is then returned, and wrapped with a closure action, which allows us to do all the nice stuff we expect from any other closure action in Ember. By returning a function in a helper, you can essentially “decorate” the action helper with some custom functionality.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token function\">compute</span><span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">[</span>actionName<span class=\"token punctuation\">,</span> <span class=\"token operator\">...</span>params<span class=\"token punctuation\">]</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">let</span> <span class=\"token function-variable function\">action</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token operator\">...</span>invocationArgs</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">let</span> args <span class=\"token operator\">=</span> params<span class=\"token punctuation\">.</span><span class=\"token function\">concat</span><span class=\"token punctuation\">(</span>invocationArgs<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">let</span> <span class=\"token punctuation\">{</span> action<span class=\"token punctuation\">,</span> handler <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">getRouteWithAction</span><span class=\"token punctuation\">(</span>router<span class=\"token punctuation\">,</span> actionName<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">return</span> run<span class=\"token punctuation\">.</span><span class=\"token function\">join</span><span class=\"token punctuation\">(</span>handler<span class=\"token punctuation\">,</span> action<span class=\"token punctuation\">,</span> <span class=\"token operator\">...</span>args<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// return the closure action</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>And because Helper classes are just like any other class in Ember, you can do the usual things like inject services, define computed properties, and so on. Here’s a contrived example:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">import</span> Ember <span class=\"token keyword\">from</span> <span class=\"token string\">'ember'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span>\n  inject<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> service <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  Helper<span class=\"token punctuation\">,</span>\n  observer<span class=\"token punctuation\">,</span>\n  get\n<span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> Ember<span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> Helper<span class=\"token punctuation\">.</span><span class=\"token function\">extend</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  session<span class=\"token operator\">:</span> <span class=\"token function\">service</span><span class=\"token punctuation\">(</span><span class=\"token string\">'session'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n\n  <span class=\"token function\">compute</span><span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">[</span>shoe<span class=\"token punctuation\">]</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token function\">parseInt</span><span class=\"token punctuation\">(</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'session.currentUser.shoeSize'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">===</span> <span class=\"token function\">parseInt</span><span class=\"token punctuation\">(</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span>shoe<span class=\"token punctuation\">,</span> <span class=\"token string\">'size'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n\n  onShoeSizeChange<span class=\"token operator\">:</span> <span class=\"token function\">observer</span><span class=\"token punctuation\">(</span><span class=\"token string\">'session.currentUser.shoeSize'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">recompute</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>The simplified Helper class was introduced in <a href=\"http://emberjs.com/blog/2015/06/12/ember-1-13-0-released.html#toc_new-ember-js-helper-api\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">1.13</a>, and are an excellent addition to Ember. In my next post, I’ll talk a little bit more about them and how we can use them to replace certain CPs.</p>\n<p>Until next time, thanks for reading!</p>","timeToRead":5,"fields":{"slug":"/2016-04-21-route-closure-actions-in-ember-js/"},"frontmatter":{"title":"Route Closure Actions in Ember.js","shortDate":"April 21, 2016","longDate":"April 21, 2016, 5:08:25 pm","description":"In my previous post, I wrote about moving singleton state in Controllers into Services that back components. This means being able to…","categories":["engineering"],"cover":{"childImageSharp":{"fluid":{"base64":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAOABQDASIAAhEBAxEB/8QAGAAAAgMAAAAAAAAAAAAAAAAAAAQCAwX/xAAVAQEBAAAAAAAAAAAAAAAAAAAAAf/aAAwDAQACEAMQAAABRq1EETIh/8QAGRAAAgMBAAAAAAAAAAAAAAAAAAIBAxES/9oACAEBAAEFAkTmWpYwmpS7qJ0//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPwE//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPwE//8QAGhAAAgIDAAAAAAAAAAAAAAAAAAEQIUFhkf/aAAgBAQAGPwJpi3GelOo//8QAGRABAAMBAQAAAAAAAAAAAAAAAQARITFB/9oACAEBAAE/Ie+WvIN9VvJnEp9htHcdtBVbFvWf/9oADAMBAAIAAwAAABAAz//EABgRAAIDAAAAAAAAAAAAAAAAAAABETFh/9oACAEDAQE/EHSJw//EABYRAQEBAAAAAAAAAAAAAAAAAAARIf/aAAgBAgEBPxCaj//EABwQAQEBAQACAwAAAAAAAAAAAAERACExQVFhkf/aAAgBAQABPxBI7kb5+uJwEh6Q+l+dXQDgWI6uKovnqLOAumSqL7Xf/9k=","aspectRatio":1.4285714285714286,"src":"/static/7623444c7e8445ca1145fe918dfdc200/7f945/devon-janse-van-rensburg-1405686-unsplash-optimized.jpg","srcSet":"/static/7623444c7e8445ca1145fe918dfdc200/e2788/devon-janse-van-rensburg-1405686-unsplash-optimized.jpg 360w,\n/static/7623444c7e8445ca1145fe918dfdc200/7d509/devon-janse-van-rensburg-1405686-unsplash-optimized.jpg 720w,\n/static/7623444c7e8445ca1145fe918dfdc200/7f945/devon-janse-van-rensburg-1405686-unsplash-optimized.jpg 1440w,\n/static/7623444c7e8445ca1145fe918dfdc200/47dad/devon-janse-van-rensburg-1405686-unsplash-optimized.jpg 2160w,\n/static/7623444c7e8445ca1145fe918dfdc200/af56c/devon-janse-van-rensburg-1405686-unsplash-optimized.jpg 2880w,\n/static/7623444c7e8445ca1145fe918dfdc200/b817c/devon-janse-van-rensburg-1405686-unsplash-optimized.jpg 5707w","sizes":"(max-width: 1440px) 100vw, 1440px"}}},"coverAuthor":"Devon Janse van Rensburg","coverOriginalUrl":"https://unsplash.com/photos/DU8Z5djVJtg?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText","keywords":["ember","ember-route-action-helper"],"published":true}}},"pageContext":{"slug":"/2016-04-21-route-closure-actions-in-ember-js/","previous":{"fields":{"slug":"/2016-01-13-warning-breaking-changes/"},"frontmatter":{"title":"Warning — Breaking Changes"}},"next":{"fields":{"slug":"/2016-04-21-declarative-templating-in-ember-with-composable-helpers/"},"frontmatter":{"title":"Declarative Templating in Ember with Composable Helpers"}}}},"staticQueryHashes":["3009088689","63159454"]}