{"componentChunkName":"component---src-templates-blog-post-tsx","path":"/2014-11-19-ember-simple-text-search-computed-property-macro/","result":{"data":{"site":{"siteMetadata":{"title":"no.lol","author":"Azmarie Wang"}},"markdownRemark":{"id":"58a5bd96-494a-5c46-83ae-4fc1845f9c43","excerpt":"Every now and then, you want to let your users quickly search for records that you’ve already loaded into your store. We can easily implement naïve search using…","html":"<p>Every now and then, you want to let your users quickly search for records that you’ve already loaded into your store. We can easily implement naïve search using Ember’s <a href=\"http://emberjs.com/api/classes/Ember.Array.html#method_filter\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Array#filter</a> and native String prototype methods, but let’s go a little step further and create a custom computed property macro (CPM) that wraps the search so we can easily drop it into other properties.</p>\n<p>Source: <a href=\"https://unsplash.com/photos/IClZBVw5W5A/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Unsplash</a> | By Todd Quackenbush</p>\n<h3 id=\"demo\" style=\"position:relative;\"><a href=\"#demo\" aria-label=\"demo permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Demo</h3>\n<p><img src=\"https://cdn-images-1.medium.com/max/800/1*LObyCCcVsFUPWE5VJ5gAwg.gif\"></p>\n<p><a href=\"http://emberjs.jsbin.com/piyoba/1/edit?html,js,output\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">JSBin</a></p>\n<h3 id=\"the-search-macro\" style=\"position:relative;\"><a href=\"#the-search-macro\" aria-label=\"the search macro permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>The search macro</h3>\n<div class=\"gatsby-code-title\">utils/computed/search.js</div>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">import</span> Ember <span class=\"token keyword\">from</span> <span class=\"token string\">'ember'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> computed <span class=\"token operator\">=</span> Ember<span class=\"token punctuation\">.</span>computed<span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token keyword\">function</span> <span class=\"token function\">search</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">dependentKey<span class=\"token punctuation\">,</span> propertyKey<span class=\"token punctuation\">,</span> searchQueryKey<span class=\"token punctuation\">,</span> returnEmptyArray</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  returnEmptyArray <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">typeof</span> returnEmptyArray <span class=\"token operator\">===</span> <span class=\"token string\">\"undefined\"</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> <span class=\"token boolean\">false</span> <span class=\"token operator\">:</span> returnEmptyArray<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">return</span> <span class=\"token function\">computed</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"\"</span> <span class=\"token operator\">+</span> dependentKey <span class=\"token operator\">+</span> <span class=\"token string\">\".@each.\"</span> <span class=\"token operator\">+</span> propertyKey<span class=\"token punctuation\">,</span> searchQueryKey<span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">var</span> items<span class=\"token punctuation\">,</span> query<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>returnEmptyArray <span class=\"token operator\">&amp;&amp;</span> <span class=\"token operator\">!</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span>searchQueryKey<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">return</span> Ember<span class=\"token punctuation\">.</span><span class=\"token constant\">A</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    query <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span>searchQueryKey<span class=\"token punctuation\">)</span> <span class=\"token operator\">||</span> <span class=\"token string\">''</span><span class=\"token punctuation\">;</span>\n    query <span class=\"token operator\">=</span> query<span class=\"token punctuation\">.</span><span class=\"token function\">toLowerCase</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    items <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span>dependentKey<span class=\"token punctuation\">)</span> <span class=\"token operator\">||</span> Ember<span class=\"token punctuation\">.</span><span class=\"token constant\">A</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">return</span> items<span class=\"token punctuation\">.</span><span class=\"token function\">filter</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">item</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>item<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span>propertyKey<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> item<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span>propertyKey<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toLowerCase</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">indexOf</span><span class=\"token punctuation\">(</span>query<span class=\"token punctuation\">)</span> <span class=\"token operator\">!==</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Our search macro returns an outer function (line#5) that takes 4 arguments, a <code class=\"language-text\">dependentKey</code>,  a <code class=\"language-text\">propertyKey</code>,  a <code class=\"language-text\">searchQueryKey</code> and a <code class=\"language-text\">returnEmptyArray</code> argument.</p>\n<p>The <code class=\"language-text\">dependentKey</code> (e.g. users)  and <code class=\"language-text\">propertyKey</code> (e.g. ‘fullName’)  relates to the array we want to search through. We specify a <code class=\"language-text\">searchQueryKey</code> so that we can update the results of our macro when the search term changes. The last argument is optional, and isn’t critical – it returns an empty array (line#9) if no query is entered.</p>\n<p>The outer function returns an inner function (line#7), which is actually just an <code class=\"language-text\">Ember.computed</code> property that observes the properties we specified in the outer function. If this syntax seems unusual to you, it uses the <a href=\"http://emberjs.com/guides/object-model/computed-properties/#toc_alternate-invocation\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">alternate invocation</a> and not the function prototype method.</p>\n<p>Using the special key <a href=\"http://emberjs.com/guides/object-model/computed-properties-and-aggregate-data/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"><code class=\"language-text\">@each</code></a>, we can make sure that Ember observes the <code class=\"language-text\">propertyKey</code> on each item in our array so that it can search through it correctly.</p>\n<p>Finally, after slightly massaging the inputs (lines#13–15), we just return the filtered array (line#17) using <a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/indexOf\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">String.prototype.indexOf</a>. While this search is naïve and probably won’t perform too well on large datasets, with our computed property macro it is very easy to implement something more efficient.</p>\n<h3 id=\"using-the-computed-property-macro\" style=\"position:relative;\"><a href=\"#using-the-computed-property-macro\" aria-label=\"using the computed property macro permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Using the computed property macro</h3>\n<p>Now we can very quickly and easily drop in text search on any of our controllers or components:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">import</span> computedSearch <span class=\"token keyword\">from</span> <span class=\"token string\">'../utils/computed/search'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> Ember<span class=\"token punctuation\">.</span>ArrayController<span class=\"token punctuation\">.</span><span class=\"token function\">extend</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  searchQuery<span class=\"token operator\">:</span>   <span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span>\n  searchResults<span class=\"token operator\">:</span> <span class=\"token function\">computedSearch</span><span class=\"token punctuation\">(</span><span class=\"token string\">'model'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'fullName'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'searchQuery'</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>By simply binding <code class=\"language-text\">searchQuery</code> to the value of any input or textarea, we’re able to drop in live search on data in the store very easily.</p>\n<p>It’s a good idea to have a look at your application to see if you find yourself repeating bits of functionality, and create custom property macros so you can move shared logic into one place. This DRYs up your code and makes it much more testable, which is probably a good thing.</p>\n<p>Thanks for reading!</p>","timeToRead":3,"fields":{"slug":"/2014-11-19-ember-simple-text-search-computed-property-macro/"},"frontmatter":{"title":"Ember – Simple text search computed property macro","shortDate":"November 19, 2014","longDate":"November 19, 2014, 10:48:11 am","description":"Every now and then, you want to let your users quickly search for records that you’ve already loaded into your store. We can easily…","categories":["engineering"],"cover":{"childImageSharp":{"fluid":{"base64":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAANABQDASIAAhEBAxEB/8QAGQAAAgMBAAAAAAAAAAAAAAAAAAQBAgMF/8QAFQEBAQAAAAAAAAAAAAAAAAAAAAH/2gAMAwEAAhADEAAAAefsxEUFA//EABkQAAMBAQEAAAAAAAAAAAAAAAECEhEAA//aAAgBAQABBQKBsBe1Bw8tBSXdDX//xAAVEQEBAAAAAAAAAAAAAAAAAAAQEf/aAAgBAwEBPwGn/8QAFREBAQAAAAAAAAAAAAAAAAAAEBH/2gAIAQIBAT8Bh//EAB0QAAEDBQEAAAAAAAAAAAAAAAABETICECEiMaH/2gAIAQEABj8Cww6raXhRt0kf/8QAGhABAQEBAQEBAAAAAAAAAAAAAREAMSFBkf/aAAgBAQABPyFjPBOy4ICTsncwEefmaEHvTHApFN9zv//aAAwDAQACAAMAAAAQez//xAAVEQEBAAAAAAAAAAAAAAAAAAAAEf/aAAgBAwEBPxAr/8QAFhEBAQEAAAAAAAAAAAAAAAAAAAER/9oACAECAQE/EHI//8QAHRABAAICAwEBAAAAAAAAAAAAAQARMVEhQXFh0f/aAAgBAQABPxAL5MiSx+xAKKFHj5AurcXfgj40dhvcPDtlV3nLuKarxxZif//Z","aspectRatio":1.5,"src":"/static/a7c3b6005e1e1c6e91b7af19e3e0a9c8/7f945/philip-swinburn-60229-unsplash-optimized.jpg","srcSet":"/static/a7c3b6005e1e1c6e91b7af19e3e0a9c8/e2788/philip-swinburn-60229-unsplash-optimized.jpg 360w,\n/static/a7c3b6005e1e1c6e91b7af19e3e0a9c8/7d509/philip-swinburn-60229-unsplash-optimized.jpg 720w,\n/static/a7c3b6005e1e1c6e91b7af19e3e0a9c8/7f945/philip-swinburn-60229-unsplash-optimized.jpg 1440w,\n/static/a7c3b6005e1e1c6e91b7af19e3e0a9c8/47dad/philip-swinburn-60229-unsplash-optimized.jpg 2160w,\n/static/a7c3b6005e1e1c6e91b7af19e3e0a9c8/af56c/philip-swinburn-60229-unsplash-optimized.jpg 2880w,\n/static/a7c3b6005e1e1c6e91b7af19e3e0a9c8/21d0b/philip-swinburn-60229-unsplash-optimized.jpg 5184w","sizes":"(max-width: 1440px) 100vw, 1440px"}}},"coverAuthor":"Philip Swinburn","coverOriginalUrl":"https://unsplash.com/photos/vS7LVkPyXJU?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText","keywords":["emberjs","computed property macros","search"],"published":true}}},"pageContext":{"slug":"/2014-11-19-ember-simple-text-search-computed-property-macro/","previous":{"fields":{"slug":"/2014-11-15-slack-style-loading-messages-in-an-ember-app/"},"frontmatter":{"title":"Slack-style loading messages in an Ember app"}},"next":{"fields":{"slug":"/2014-11-21-ember-js-detecting-if-a-dom-element-is-in-the-viewport/"},"frontmatter":{"title":"Ember.js — Detecting if a DOM Element is in the Viewport"}}}},"staticQueryHashes":["3009088689","63159454"]}