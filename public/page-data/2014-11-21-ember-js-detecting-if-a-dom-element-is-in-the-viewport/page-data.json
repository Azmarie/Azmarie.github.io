{"componentChunkName":"component---src-templates-blog-post-tsx","path":"/2014-11-21-ember-js-detecting-if-a-dom-element-is-in-the-viewport/","result":{"data":{"site":{"siteMetadata":{"title":"no.lol","author":"Azmarie Wang"}},"markdownRemark":{"id":"377a964d-5e40-5678-9d37-327e8faba5bd","excerpt":"Detecting whether or not an element is visible in the viewport is very useful when it comes to triggering animations or events. Before you drop in another…","html":"<p>Detecting whether or not an element is visible in the viewport is very useful when it comes to triggering animations or events. Before you drop in another jQuery plugin though, have a look at how easy it is to create a Mixin that you can add to any View or Component. Once added, you can simply ask that element if it’s in the viewport using the property the Mixin injects.</p>\n<p>Let’s get started!</p>\n<p><a href=\"http://emberjs.jsbin.com/jitehe/6/edit?html,js,output\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">JS Bin Demo</a></p>\n<h3 id=\"inviewportmixin\" style=\"position:relative;\"><a href=\"#inviewportmixin\" aria-label=\"inviewportmixin permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>InViewportMixin</h3>\n<p>I’ll first show the entire mixin, and then walk through each logical section. The idea is essentially to make use of the <a href=\"https://developer.mozilla.org/en-US/docs/Web/API/Element.getBoundingClientRect\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">getBoundingClientRect</a> method on each element to get the details of the element’s position relative to the viewport. We then compare this to the window’s <a href=\"https://developer.mozilla.org/en-US/docs/Web/API/Window.innerHeight\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">innerHeight</a> and <a href=\"https://developer.mozilla.org/en-US/docs/Web/API/Window.innerWidth\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">innerWidth</a> to determine whether or not the element is in the viewport. To keep things reactive, we bind the scroll event to update the element’s new position in the viewport.</p>\n<blockquote>\n<p>getBoundingClientRect — The amount of scrolling that has been done of the viewport area (or any other scrollable element) is taken into account when computing the bounding rectangle.</p>\n</blockquote>\n<h4 id=\"full-gist\" style=\"position:relative;\"><a href=\"#full-gist\" aria-label=\"full gist permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Full Gist</h4>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">import</span> Ember <span class=\"token keyword\">from</span> <span class=\"token string\">'ember'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> Ember<span class=\"token punctuation\">.</span>Mixin<span class=\"token punctuation\">.</span><span class=\"token function\">create</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  scrollTimeout<span class=\"token operator\">:</span>      <span class=\"token number\">100</span><span class=\"token punctuation\">,</span>\n  boundingClientRect<span class=\"token operator\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>\n  windowHeight<span class=\"token operator\">:</span>       <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>\n  windowWidth<span class=\"token operator\">:</span>        <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>\n\n  enteredViewport<span class=\"token operator\">:</span> Ember<span class=\"token punctuation\">.</span><span class=\"token function\">computed</span><span class=\"token punctuation\">(</span><span class=\"token string\">'boundingClientRect'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'windowHeight'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'windowWidth'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">var</span> rect<span class=\"token punctuation\">,</span> windowHeight<span class=\"token punctuation\">,</span> windowWidth<span class=\"token punctuation\">;</span>\n    rect <span class=\"token operator\">=</span>         <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'boundingClientRect'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    windowHeight <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'windowHeight'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    windowWidth <span class=\"token operator\">=</span>  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'windowWidth'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n      rect<span class=\"token punctuation\">.</span>top <span class=\"token operator\">>=</span> <span class=\"token number\">0</span> <span class=\"token operator\">&amp;&amp;</span>\n      rect<span class=\"token punctuation\">.</span>left <span class=\"token operator\">>=</span> <span class=\"token number\">0</span> <span class=\"token operator\">&amp;&amp;</span>\n      rect<span class=\"token punctuation\">.</span>bottom <span class=\"token operator\">&lt;=</span> windowHeight <span class=\"token operator\">&amp;&amp;</span>\n      rect<span class=\"token punctuation\">.</span>right <span class=\"token operator\">&lt;=</span> windowWidth\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n\n  exitedViewport<span class=\"token operator\">:</span> Ember<span class=\"token punctuation\">.</span>computed<span class=\"token punctuation\">.</span><span class=\"token function\">not</span><span class=\"token punctuation\">(</span><span class=\"token string\">'enteredViewport'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n\n  <span class=\"token function-variable function\">_updateBoundingClientRect</span><span class=\"token operator\">:</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">var</span> el<span class=\"token punctuation\">;</span>\n    el <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">$</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span><span class=\"token string\">'boundingClientRect'</span><span class=\"token punctuation\">,</span> el<span class=\"token punctuation\">.</span><span class=\"token function\">getBoundingClientRect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n\n  _setup<span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> Ember<span class=\"token punctuation\">.</span>run<span class=\"token punctuation\">.</span><span class=\"token function\">scheduleOnce</span><span class=\"token punctuation\">(</span><span class=\"token string\">'afterRender'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">_updateBoundingClientRect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span><span class=\"token string\">'windowHeight'</span><span class=\"token punctuation\">,</span> window<span class=\"token punctuation\">.</span>innerHeight <span class=\"token operator\">||</span> document<span class=\"token punctuation\">.</span>documentElement<span class=\"token punctuation\">.</span>clientHeight<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span><span class=\"token string\">'windowWidth'</span><span class=\"token punctuation\">,</span> window<span class=\"token punctuation\">.</span>innerWidth <span class=\"token operator\">||</span> document<span class=\"token punctuation\">.</span>documentElement<span class=\"token punctuation\">.</span>clientWidth<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'didInsertElement'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n\n  <span class=\"token function-variable function\">_scrollHandler</span><span class=\"token operator\">:</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> Ember<span class=\"token punctuation\">.</span>run<span class=\"token punctuation\">.</span><span class=\"token function\">debounce</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'_updateBoundingClientRect'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'scrollTimeout'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n\n  _bindScroll<span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">var</span> scrollHandler<span class=\"token punctuation\">;</span>\n    scrollHandler <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">_scrollHandler</span><span class=\"token punctuation\">.</span><span class=\"token function\">bind</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    Ember<span class=\"token punctuation\">.</span><span class=\"token function\">$</span><span class=\"token punctuation\">(</span>document<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'touchmove.scrollable'</span><span class=\"token punctuation\">,</span> scrollHandler<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    Ember<span class=\"token punctuation\">.</span><span class=\"token function\">$</span><span class=\"token punctuation\">(</span>window<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'scroll.scrollable'</span><span class=\"token punctuation\">,</span> scrollHandler<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'didInsertElement'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n\n  _unbindScroll<span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    Ember<span class=\"token punctuation\">.</span><span class=\"token function\">$</span><span class=\"token punctuation\">(</span>window<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">off</span><span class=\"token punctuation\">(</span><span class=\"token string\">'.scrollable'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    Ember<span class=\"token punctuation\">.</span><span class=\"token function\">$</span><span class=\"token punctuation\">(</span>document<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">off</span><span class=\"token punctuation\">(</span><span class=\"token string\">'.scrollable'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'willDestroyElement'</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h4 id=\"getting-the-details-we-need\" style=\"position:relative;\"><a href=\"#getting-the-details-we-need\" aria-label=\"getting the details we need permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Getting the Details we Need</h4>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">scrollTimeout<span class=\"token operator\">:</span>      <span class=\"token number\">100</span><span class=\"token punctuation\">,</span>\nboundingClientRect<span class=\"token operator\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>\nwindowHeight<span class=\"token operator\">:</span>       <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>\nwindowWidth<span class=\"token operator\">:</span>        <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>\n\n<span class=\"token function-variable function\">_updateBoundingClientRect</span><span class=\"token operator\">:</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">var</span> el<span class=\"token punctuation\">;</span>\n  el <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">$</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span><span class=\"token string\">'boundingClientRect'</span><span class=\"token punctuation\">,</span> el<span class=\"token punctuation\">.</span><span class=\"token function\">getBoundingClientRect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n\n_setup<span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> Ember<span class=\"token punctuation\">.</span>run<span class=\"token punctuation\">.</span><span class=\"token function\">scheduleOnce</span><span class=\"token punctuation\">(</span><span class=\"token string\">'afterRender'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">_updateBoundingClientRect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span><span class=\"token string\">'windowHeight'</span><span class=\"token punctuation\">,</span> window<span class=\"token punctuation\">.</span>innerHeight <span class=\"token operator\">||</span> document<span class=\"token punctuation\">.</span>documentElement<span class=\"token punctuation\">.</span>clientHeight<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span><span class=\"token string\">'windowWidth'</span><span class=\"token punctuation\">,</span> window<span class=\"token punctuation\">.</span>innerWidth <span class=\"token operator\">||</span> document<span class=\"token punctuation\">.</span>documentElement<span class=\"token punctuation\">.</span>clientWidth<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'didInsertElement'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></code></pre></div>\n<p>First, let’s setup the basic building properties we need in our view: <code class=\"language-text\">scrollTimeout</code>, <code class=\"language-text\">boundingClientRect</code>, <code class=\"language-text\">windowHeight</code> and <code class=\"language-text\">windowWidth.</code> Because it’s computationally expensive to listen to every single scroll event, we’ll set a sensible timeout to <a href=\"http://emberjs.com/api/classes/Ember.run.html#method_debounce\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">debounce</a> the scroll handler. This basically means the handler will only be called every 100ms in our case.</p>\n<p>Next, we need to setup the initial values (L#12) of the properties when the element is inserted into the page. Ember’s <a href=\"http://emberjs.com/api/classes/Ember.View.html#event_didInsertElement\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">View#didInsertElement</a> is called when the view has been inserted into the DOM, so we can hook into it to get the right details at the right time. To ensure that this fires only after the element has been rendered, we use <a href=\"http://emberjs.com/api/classes/Ember.run.html#method_scheduleOnce\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Ember.run#scheduleOnce</a> to schedule the update once in the <code class=\"language-text\">afterRender</code> queue. If you’re unfamiliar with how the Ember run loop works, I highly recommend reading <a href=\"http://ember.zone/a-50000-foot-overview-of-the-ember-js-run-loop/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">EmberZone’s 50,000 foot overview</a>.</p>\n<p>When the element is rendered on the screen, we simply use jQuery (one of Ember’s dependencies) to <a href=\"http://emberjs.com/api/classes/Ember.View.html#method__\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">get the DOM element</a> of the view, then set the value of the <code class=\"language-text\">boundingClientRect</code> property to the element’s <code class=\"language-text\">getBoundingClientRect()</code> object.</p>\n<h4 id=\"handling-scroll-events-and-listeners\" style=\"position:relative;\"><a href=\"#handling-scroll-events-and-listeners\" aria-label=\"handling scroll events and listeners permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Handling Scroll Events and Listeners</h4>\n<p>In order to update <code class=\"language-text\">boundingClientRect</code> every time the window is scrolled, we’ll need to setup some event listeners:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token function-variable function\">_scrollHandler</span><span class=\"token operator\">:</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> Ember<span class=\"token punctuation\">.</span>run<span class=\"token punctuation\">.</span><span class=\"token function\">debounce</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'_updateBoundingClientRect'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'scrollTimeout'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n\n_bindScroll<span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">var</span> scrollHandler<span class=\"token punctuation\">;</span>\n  scrollHandler <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">_scrollHandler</span><span class=\"token punctuation\">.</span><span class=\"token function\">bind</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  Ember<span class=\"token punctuation\">.</span><span class=\"token function\">$</span><span class=\"token punctuation\">(</span>document<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'touchmove.scrollable'</span><span class=\"token punctuation\">,</span> scrollHandler<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  Ember<span class=\"token punctuation\">.</span><span class=\"token function\">$</span><span class=\"token punctuation\">(</span>window<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'scroll.scrollable'</span><span class=\"token punctuation\">,</span> scrollHandler<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'didInsertElement'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n\n_unbindScroll<span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  Ember<span class=\"token punctuation\">.</span><span class=\"token function\">$</span><span class=\"token punctuation\">(</span>window<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">off</span><span class=\"token punctuation\">(</span><span class=\"token string\">'.scrollable'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  Ember<span class=\"token punctuation\">.</span><span class=\"token function\">$</span><span class=\"token punctuation\">(</span>document<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">off</span><span class=\"token punctuation\">(</span><span class=\"token string\">'.scrollable'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'willDestroyElement'</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>The <code class=\"language-text\">_scrollHandler</code> method <a href=\"http://emberjs.com/api/classes/Ember.run.html#method_debounce\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">debounces</a> function calls to <code class=\"language-text\">_updateBoundingClientRect</code> (defined earlier) based on the <code class=\"language-text\">scrollTimeout</code> we set initially. This is because running the method on every single scroll event is expensive, and we don’t really need to be that responsive.</p>\n<p><img src=\"https://cdn-images-1.medium.com/max/400/1*IB8SGVSeUS62GAV5ySiWFA.jpeg\"></p>\n<p>We’ll want to keep the timeout between 100 — 300ms, so users perceive it as nearly instantaneous.</p>\n<p><code class=\"language-text\">_bindScroll</code> and <code class=\"language-text\">_unbindScroll</code> creates and destroys our scroll listener when the element is inserted, and when it is destroyed. Unbinding listeners is good practice, otherwise you’ll cause memory leaks in your app.</p>\n<h4 id=\"exposing-the-public-api-to-views-and-components\" style=\"position:relative;\"><a href=\"#exposing-the-public-api-to-views-and-components\" aria-label=\"exposing the public api to views and components permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Exposing the Public API to Views and Components</h4>\n<p>Now that we’ve created the logic for our mixin, it’s time to let our API be consumed by the Views or Components we want to track.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">enteredViewport<span class=\"token operator\">:</span> Ember<span class=\"token punctuation\">.</span><span class=\"token function\">computed</span><span class=\"token punctuation\">(</span><span class=\"token string\">'boundingClientRect'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'windowHeight'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'windowWidth'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">var</span> rect<span class=\"token punctuation\">,</span> windowHeight<span class=\"token punctuation\">,</span> windowWidth<span class=\"token punctuation\">;</span>\n  rect <span class=\"token operator\">=</span>         <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'boundingClientRect'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  windowHeight <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'windowHeight'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  windowWidth <span class=\"token operator\">=</span>  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'windowWidth'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    rect<span class=\"token punctuation\">.</span>top <span class=\"token operator\">>=</span> <span class=\"token number\">0</span> <span class=\"token operator\">&amp;&amp;</span>\n    rect<span class=\"token punctuation\">.</span>left <span class=\"token operator\">>=</span> <span class=\"token number\">0</span> <span class=\"token operator\">&amp;&amp;</span>\n    rect<span class=\"token punctuation\">.</span>bottom <span class=\"token operator\">&lt;=</span> windowHeight <span class=\"token operator\">&amp;&amp;</span>\n    rect<span class=\"token punctuation\">.</span>right <span class=\"token operator\">&lt;=</span> windowWidth\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n\nexitedViewport<span class=\"token operator\">:</span> Ember<span class=\"token punctuation\">.</span>computed<span class=\"token punctuation\">.</span><span class=\"token function\">not</span><span class=\"token punctuation\">(</span><span class=\"token string\">'enteredViewport'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></code></pre></div>\n<blockquote>\n<p>The idea is essentially to make use of the getBoundingClientRect method on each element to get the details of the element’s position relative to the viewport.</p>\n</blockquote>\n<p><code class=\"language-text\">enteredViewport</code> is a <a href=\"http://emberjs.com/guides/object-model/computed-properties/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">computed property</a> that determines whether or not the element is inside the viewport. We observe the three properties we set initially, so that the computed property updates when their values change. If you have a read of the API for getBoundingClientRect(), you’ll realize that an element is in the viewport when it’s bottom and right values are within the window’s innerHeight/width. This returns a boolean value, that we can then use in our Views or Components.</p>\n<p><code class=\"language-text\">exitedViewport</code> is a <a href=\"http://emberjs.com/api/#method_computed_not\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">computed property macro</a> that simply inverses another property after coercing it into a boolean value.</p>\n<p>With these APIs, we can now do some interesting things when an element enters or leaves the viewport!</p>\n<h4 id=\"consuming-the-mixin\" style=\"position:relative;\"><a href=\"#consuming-the-mixin\" aria-label=\"consuming the mixin permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Consuming the Mixin</h4>\n<p>With Ember, reusable mixins are easy to use. Here’s the example I made in my <a href=\"http://emberjs.jsbin.com/jitehe/6/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">JS Bin</a>:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">App<span class=\"token punctuation\">.</span>ThisIsDogComponent <span class=\"token operator\">=</span> Ember<span class=\"token punctuation\">.</span>Component<span class=\"token punctuation\">.</span><span class=\"token function\">extend</span><span class=\"token punctuation\">(</span>App<span class=\"token punctuation\">.</span>InViewportMixin<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n  classNames<span class=\"token operator\">:</span>        <span class=\"token punctuation\">[</span><span class=\"token string\">'dog-card'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  classNameBindings<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'enteredViewport:entered-viewport'</span><span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>With the mixin added, you can use <code class=\"language-text\">enteredViewport</code> and <code class=\"language-text\">exitedViewport</code> like any other property in your View or Component.</p>\n<p>The component I made in my JS Bin renders a card with a dog breed and some filler description, and its style updates when the cards enter the viewport. It’s a <a href=\"http://gfycat.com/FatalAdvancedKite\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">simple example</a>, but it should give you an idea of what you can do with this. You could have animations fire, or you could perform certain logic when something enters the viewport.</p>\n<p>I hope you’ve enjoyed reading! If you have any questions, you can <a href=\"https://twitter.com/sugarpirate_\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">tweet</a> me or leave a note on this post.</p>","timeToRead":6,"fields":{"slug":"/2014-11-21-ember-js-detecting-if-a-dom-element-is-in-the-viewport/"},"frontmatter":{"title":"Ember.js — Detecting if a DOM Element is in the Viewport","shortDate":"November 21, 2014","longDate":"November 21, 2014, 2:27:45 pm","description":"Detecting whether or not an element is visible is very useful when it comes to triggering animations or events. Before you drop in another…","categories":["engineering"],"cover":{"childImageSharp":{"fluid":{"base64":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAANABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAMEAv/EABUBAQEAAAAAAAAAAAAAAAAAAAEC/9oADAMBAAIQAxAAAAGtL8rKMC//xAAaEAACAgMAAAAAAAAAAAAAAAAAAQIREjFD/9oACAEBAAEFAkqMBxOY9//EABoRAAEFAQAAAAAAAAAAAAAAAAABAgMSIiH/2gAIAQMBAT8Bny2yDIMp0//EABgRAAMBAQAAAAAAAAAAAAAAAAABIQID/9oACAECAQE/AcVj6U//xAAVEAEBAAAAAAAAAAAAAAAAAAAQEf/aAAgBAQAGPwJr/8QAGxABAAICAwAAAAAAAAAAAAAAAQARITFBUXH/2gAIAQEAAT8hVKopxHL3UoZVU91UosI1esY1P//aAAwDAQACAAMAAAAQGB//xAAZEQEAAgMAAAAAAAAAAAAAAAABADFBUeH/2gAIAQMBAT8QaWB5BUVW5//EABYRAQEBAAAAAAAAAAAAAAAAACEAAf/aAAgBAgEBPxDYbML/xAAbEAACAwEBAQAAAAAAAAAAAAABEQAhMUFRwf/aAAgBAQABPxALQK0C18gAJSAOAlBF9lJF4PRGJ72cFEjaf//Z","aspectRatio":1.5,"src":"/static/739f0bef94b03762d3ed90961798c941/7f945/pawel-czerwinski-1404596-unsplash-optimized.jpg","srcSet":"/static/739f0bef94b03762d3ed90961798c941/e2788/pawel-czerwinski-1404596-unsplash-optimized.jpg 360w,\n/static/739f0bef94b03762d3ed90961798c941/7d509/pawel-czerwinski-1404596-unsplash-optimized.jpg 720w,\n/static/739f0bef94b03762d3ed90961798c941/7f945/pawel-czerwinski-1404596-unsplash-optimized.jpg 1440w,\n/static/739f0bef94b03762d3ed90961798c941/47dad/pawel-czerwinski-1404596-unsplash-optimized.jpg 2160w,\n/static/739f0bef94b03762d3ed90961798c941/af56c/pawel-czerwinski-1404596-unsplash-optimized.jpg 2880w,\n/static/739f0bef94b03762d3ed90961798c941/6a059/pawel-czerwinski-1404596-unsplash-optimized.jpg 6000w","sizes":"(max-width: 1440px) 100vw, 1440px"}}},"coverAuthor":"Paweł Czerwiński","coverOriginalUrl":"https://unsplash.com/photos/R7n2WIyFr3E?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText","keywords":["emberjs","in viewport"],"published":true}}},"pageContext":{"slug":"/2014-11-21-ember-js-detecting-if-a-dom-element-is-in-the-viewport/","previous":{"fields":{"slug":"/2014-11-19-ember-simple-text-search-computed-property-macro/"},"frontmatter":{"title":"Ember – Simple text search computed property macro"}},"next":{"fields":{"slug":"/2014-11-30-adding-flash-messages-to-an-ember-app/"},"frontmatter":{"title":"Adding Flash Messages to an Ember App"}}}},"staticQueryHashes":["3009088689","63159454"]}