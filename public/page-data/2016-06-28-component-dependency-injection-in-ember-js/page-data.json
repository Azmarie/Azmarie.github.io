{"componentChunkName":"component---src-templates-blog-post-tsx","path":"/2016-06-28-component-dependency-injection-in-ember-js/","result":{"data":{"site":{"siteMetadata":{"title":"no.lol","author":"Azmarie Wang"}},"markdownRemark":{"id":"ce242c70-7694-58a2-a10e-7dde11d21995","excerpt":"The Dependency Injection (DI) pattern is a subset of Inversion of Control, and is a useful technique for decoupling the creation of a dependency from the object‚Ä¶","html":"<p>The <a href=\"http://martinfowler.com/articles/injection.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Dependency Injection</a> (DI) pattern is a subset of <a href=\"http://martinfowler.com/articles/injection.html#InversionOfControl\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Inversion of Control</a>, and is a useful technique for decoupling the creation of a dependency from the object itself. Don‚Äôt let the terminology scare you though! DI is really just <a href=\"http://www.jamesshore.com/Blog/Dependency-Injection-Demystified.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">giving an object its instance variables</a>.</p>\n<p>For example, below is a simple example of the <code class=\"language-text\">Player</code> class being implicitly coupled to the <code class=\"language-text\">Bag</code> class. The <code class=\"language-text\">Player</code> is responsible for creating the dependent objects:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Player</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>inventory <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Bag</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> <span class=\"token comment\">/* ... */</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">item</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>inventory<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>item<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">let</span> bob <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Player</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Although the example is simple, it‚Äôs fairly easy to see that this implementation could be difficult to test in isolation, as you now need to know about the <code class=\"language-text\">Bag</code> class in the <code class=\"language-text\">Player</code> class‚Äô test. DI can help us here:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Player</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> storageObject <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>inventory <span class=\"token operator\">=</span> storageObject<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">item</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>inventory<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>item<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">let</span> bob <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Player</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> storageObject<span class=\"token operator\">:</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Bag</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> <span class=\"token comment\">/* ... */</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>In the second example, we ‚Äúinverted control‚Äù of the player‚Äôs inventory, and now we pass the storage object instance at runtime. This means that in our test, we can simply stub the inventory object out:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">'it adds an item'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">assert</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">let</span> dummyStorage <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span> <span class=\"token comment\">/* ... */</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">let</span> dummy <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Player</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> storageObject<span class=\"token operator\">:</span> dummyStorage <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  assert<span class=\"token punctuation\">.</span><span class=\"token function\">ok</span><span class=\"token punctuation\">(</span><span class=\"token comment\">/* ... */</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>The <code class=\"language-text\">Player</code> class no longer needs to know anything about the <code class=\"language-text\">Bag</code>, and also allows other kinds of storage object classes to be used. Great!</p>\n<h4 id=\"component-dependency-injection\" style=\"position:relative;\"><a href=\"#component-dependency-injection\" aria-label=\"component dependency injection permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Component Dependency Injection</h4>\n<p>I recently realized that the DI pattern can also be used to great effect in Ember components. For example, let‚Äôs say you have a container or parent component that uses multiple child components:</p>\n<div class=\"gatsby-code-title\">templates/application.hbs</div>\n<div class=\"gatsby-highlight\" data-language=\"handlebars\"><pre class=\"language-handlebars\"><code class=\"language-handlebars\"><span class=\"token handlebars language-handlebars\"><span class=\"token delimiter punctuation\">{{</span><span class=\"token variable\">edit-location</span> <span class=\"token variable\">location</span><span class=\"token punctuation\">=</span><span class=\"token variable\">location</span><span class=\"token delimiter punctuation\">}}</span></span></code></pre></div>\n<div class=\"gatsby-code-title\">components/edit-location.hbs</div>\n<div class=\"gatsby-highlight\" data-language=\"handlebars\"><pre class=\"language-handlebars\"><code class=\"language-handlebars\"><span class=\"token handlebars language-handlebars\"><span class=\"token delimiter punctuation\">{{</span><span class=\"token variable\">google-map</span>\n    <span class=\"token variable\">lat</span><span class=\"token punctuation\">=</span><span class=\"token variable\">location</span><span class=\"token punctuation\">.</span><span class=\"token variable\">lat</span>\n    <span class=\"token variable\">lng</span><span class=\"token punctuation\">=</span><span class=\"token variable\">location</span><span class=\"token punctuation\">.</span><span class=\"token variable\">lng</span>\n    <span class=\"token variable\">setLatLng</span><span class=\"token punctuation\">=</span><span class=\"token punctuation\">(</span><span class=\"token variable\">action</span> <span class=\"token string\">\"setLatLng\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token variable\">setMarkerRadius</span><span class=\"token punctuation\">=</span><span class=\"token punctuation\">(</span><span class=\"token variable\">action</span> <span class=\"token string\">\"setMarkerRadius\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token delimiter punctuation\">}}</span></span>\n<span class=\"token handlebars language-handlebars\"><span class=\"token delimiter punctuation\">{{</span><span class=\"token variable\">edit-location-form</span> <span class=\"token variable\">location</span><span class=\"token punctuation\">=</span><span class=\"token variable\">location</span><span class=\"token delimiter punctuation\">}}</span></span>\n<span class=\"token handlebars language-handlebars\"><span class=\"token delimiter punctuation\">{{</span><span class=\"token variable\">location-activity</span> <span class=\"token variable\">location</span><span class=\"token punctuation\">=</span><span class=\"token variable\">location</span><span class=\"token delimiter punctuation\">}}</span></span></code></pre></div>\n<p>The parent component <code class=\"language-text\">edit-location</code>‚Äôs primary responsibility is to provide UI to edit a location. It could have actions defined on it, like so:</p>\n<div class=\"gatsby-code-title\">components/edit-location.js</div>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> Component<span class=\"token punctuation\">.</span><span class=\"token function\">extend</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  actions<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">setLatLng</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">latLng</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token comment\">// logic</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n\n    <span class=\"token function\">setMarkerRadius</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">radius</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token comment\">// logic</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>The <code class=\"language-text\">google-map</code> component provides UI for the user to drop a marker on a map, and adjust the radius around the marker by using the radius control. Needless to say, that UI interaction is quite difficult to test, and is tested in the <code class=\"language-text\">google-map</code> component test itself. Because the <code class=\"language-text\">edit-location</code> component is tightly coupled to its child components, testing it is no easy task. We need to make sure all the child components are setup just right, which introduces a lot of boilerplate in our component integration test.</p>\n<h4 id=\"not-my-concern\" style=\"position:relative;\"><a href=\"#not-my-concern\" aria-label=\"not my concern permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Not my¬†concern</h4>\n<p>In this scenario, the <code class=\"language-text\">edit-location</code> component itself shouldn‚Äôt need to concern itself with <em>how</em> the <code class=\"language-text\">latLng</code> and <code class=\"language-text\">radius</code> arguments are passed into its actions. The drag and drop UI is a concern of the <code class=\"language-text\">google-map</code> component, and as such should be tested in its own component integration test.</p>\n<p>Using DI, we can decouple the <code class=\"language-text\">edit-location</code> component from its child components, and clean up our tests. This technique is currently only possible with <a href=\"http://emberjs.com/blog/2016/01/15/ember-2-3-released.html#toc_contextual-components\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">contextual components</a> due to the use of the <code class=\"language-text\">component</code> and <code class=\"language-text\">hash</code> helpers, which were made available in <a href=\"http://emberjs.com/blog/2016/01/15/ember-2-3-released.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Ember 2.3.0</a>.</p>\n<div class=\"gatsby-code-title\">application.hbs</div>\n<div class=\"gatsby-highlight\" data-language=\"handlebars\"><pre class=\"language-handlebars\"><code class=\"language-handlebars\"><span class=\"token handlebars language-handlebars\"><span class=\"token delimiter punctuation\">{{</span><span class=\"token variable\">edit-location</span>\n    <span class=\"token variable\">location</span><span class=\"token punctuation\">=</span><span class=\"token variable\">location</span>\n    <span class=\"token variable\">ui</span><span class=\"token punctuation\">=</span><span class=\"token punctuation\">(</span><span class=\"token variable\">hash</span>\n      <span class=\"token variable\">location-map</span><span class=\"token punctuation\">=</span><span class=\"token punctuation\">(</span><span class=\"token variable\">component</span> <span class=\"token string\">\"google-map\"</span><span class=\"token punctuation\">)</span>\n      <span class=\"token variable\">location-form</span><span class=\"token punctuation\">=</span><span class=\"token punctuation\">(</span><span class=\"token variable\">component</span> <span class=\"token string\">\"edit-location-form\"</span><span class=\"token punctuation\">)</span>\n      <span class=\"token variable\">location-activity</span><span class=\"token punctuation\">=</span><span class=\"token punctuation\">(</span><span class=\"token variable\">component</span> <span class=\"token string\">\"location-activity\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n<span class=\"token delimiter punctuation\">}}</span></span></code></pre></div>\n<p>We‚Äôve passed in a hash of the child components using the <code class=\"language-text\">hash</code> and <code class=\"language-text\">component</code> helpers. This effectively inverts control to the template that calls the <code class=\"language-text\">edit-location</code> form:</p>\n<div class=\"gatsby-code-title\">components/edit-location.hbs</div>\n<div class=\"gatsby-highlight\" data-language=\"handlebars\"><pre class=\"language-handlebars\"><code class=\"language-handlebars\"><span class=\"token handlebars language-handlebars\"><span class=\"token delimiter punctuation\">{{</span><span class=\"token variable\">ui</span><span class=\"token punctuation\">.</span><span class=\"token variable\">location-map</span>\n    <span class=\"token variable\">lat</span><span class=\"token punctuation\">=</span><span class=\"token variable\">location</span><span class=\"token punctuation\">.</span><span class=\"token variable\">lat</span>\n    <span class=\"token variable\">lng</span><span class=\"token punctuation\">=</span><span class=\"token variable\">location</span><span class=\"token punctuation\">.</span><span class=\"token variable\">lng</span>\n    <span class=\"token variable\">setLatLng</span><span class=\"token punctuation\">=</span><span class=\"token punctuation\">(</span><span class=\"token variable\">action</span> <span class=\"token string\">\"setLatLng\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token variable\">setMarkerRadius</span><span class=\"token punctuation\">=</span><span class=\"token punctuation\">(</span><span class=\"token variable\">action</span> <span class=\"token string\">\"setMarkerRadius\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token delimiter punctuation\">}}</span></span>\n<span class=\"token handlebars language-handlebars\"><span class=\"token delimiter punctuation\">{{</span><span class=\"token variable\">ui</span><span class=\"token punctuation\">.</span><span class=\"token variable\">location-form</span> <span class=\"token variable\">location</span><span class=\"token punctuation\">=</span><span class=\"token variable\">location</span><span class=\"token delimiter punctuation\">}}</span></span>\n<span class=\"token handlebars language-handlebars\"><span class=\"token delimiter punctuation\">{{</span><span class=\"token variable\">ui</span><span class=\"token punctuation\">.</span><span class=\"token variable\">location-activity</span> <span class=\"token variable\">location</span><span class=\"token punctuation\">=</span><span class=\"token variable\">location</span><span class=\"token delimiter punctuation\">}}</span></span></code></pre></div>\n<p>Install the <a href=\"https://github.com/poteto/ember-test-component\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">test helper</a>:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">ember install ember-test-component</code></pre></div>\n<p>Now, in our tests, we‚Äôll need to write a little test helper (or use the addon above) to create a dummy component we can use to no-op (do nothing). Credit goes to <a href=\"https://twitter.com/runspired\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">@runspired</a> for nudging me in the right direction:</p>\n<div class=\"gatsby-code-title\">tests/helpers/dummy-component.js</div>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">import</span> Ember <span class=\"token keyword\">from</span> <span class=\"token string\">'ember'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span>\n  Component<span class=\"token punctuation\">,</span>\n  assign<span class=\"token punctuation\">,</span>\n  getOwner\n<span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> Ember<span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">function</span> <span class=\"token function\">registerDummyComponent</span><span class=\"token punctuation\">(</span>context<span class=\"token punctuation\">,</span> name <span class=\"token operator\">=</span> <span class=\"token string\">'dummy-component'</span><span class=\"token punctuation\">,</span> opts <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">let</span> owner <span class=\"token operator\">=</span> <span class=\"token function\">getOwner</span><span class=\"token punctuation\">(</span>context<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">let</span> options <span class=\"token operator\">=</span> <span class=\"token function\">assign</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> tagName<span class=\"token operator\">:</span> <span class=\"token string\">'dummy'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> opts<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">let</span> DummyComponent <span class=\"token operator\">=</span> Component<span class=\"token punctuation\">.</span><span class=\"token function\">extend</span><span class=\"token punctuation\">(</span>options<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token function\">unregisterDummyComponent</span><span class=\"token punctuation\">(</span>context<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  owner<span class=\"token punctuation\">.</span><span class=\"token function\">register</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">component:</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>name<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span> DummyComponent<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">function</span> <span class=\"token function\">unregisterDummyComponent</span><span class=\"token punctuation\">(</span>context<span class=\"token punctuation\">,</span> name <span class=\"token operator\">=</span> <span class=\"token string\">'dummy-component'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">let</span> owner <span class=\"token operator\">=</span> <span class=\"token function\">getOwner</span><span class=\"token punctuation\">(</span>context<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>owner<span class=\"token punctuation\">.</span><span class=\"token function\">resolveRegistration</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">component:</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>name<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    owner<span class=\"token punctuation\">.</span><span class=\"token function\">unregister</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">component:</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>name<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>This test helper registers a fake component in the container, making it available for us to use in our component integration test:</p>\n<div class=\"gatsby-code-title\">tests/integration/edit-location-test.js</div>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">'it ...'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">assert</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">registerDummyComponent</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span><span class=\"token string\">'location'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">render</span><span class=\"token punctuation\">(</span>hbs<span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">\n    {{edit-location\n        location=location\n        ui=(hash\n          location-map=(component \"dummy-component\")\n          location-form=(component \"dummy-component\")\n          location-activity=(component \"dummy-component\"))\n    }}\n  </span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  assert<span class=\"token punctuation\">.</span><span class=\"token function\">ok</span><span class=\"token punctuation\">(</span><span class=\"token comment\">/* ... */</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Now we can test the <code class=\"language-text\">edit-location</code> component itself without worrying about setting up child components. That said, DI still allows us to test those child components integrating with <code class=\"language-text\">edit-location</code>, in a more controlled environment:</p>\n<div class=\"gatsby-code-title\">tests/integration/edit-location-test.js</div>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">'it updates location via the form'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">assert</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">registerDummyComponent</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span><span class=\"token string\">'location'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">render</span><span class=\"token punctuation\">(</span>hbs<span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">\n    {{edit-location\n        location=location\n        ui=(hash\n          location-map=(component \"dummy-component\")\n          location-form=(component \"edit-location-form\")\n          location-activity=(component \"dummy-component\"))\n    }}\n  </span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  assert<span class=\"token punctuation\">.</span><span class=\"token function\">ok</span><span class=\"token punctuation\">(</span><span class=\"token comment\">/* ... */</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>I hope you find this useful! It‚Äôs not a silver bullet by any stretch, but DI can help you write better isolated components and simplify your tests.</p>\n<p>Until next time! üëã</p>","timeToRead":5,"fields":{"slug":"/2016-06-28-component-dependency-injection-in-ember-js/"},"frontmatter":{"title":"Component dependency injection in Ember.js","shortDate":"June 28, 2016","longDate":"June 28, 2016, 5:01:02 pm","description":"The Dependency Injection (DI) pattern is a subset of Inversion of Control, and is a useful technique for decoupling the creation of a‚Ä¶","categories":["engineering"],"cover":{"childImageSharp":{"fluid":{"base64":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAANABQDASIAAhEBAxEB/8QAGAAAAwEBAAAAAAAAAAAAAAAAAAIEAQX/xAAUAQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIQAxAAAAHl41AhKH//xAAaEAACAwEBAAAAAAAAAAAAAAAAAQIDEQQS/9oACAEBAAEFAlHTybDFdMn02DbZ/8QAFREBAQAAAAAAAAAAAAAAAAAAABH/2gAIAQMBAT8BR//EABURAQEAAAAAAAAAAAAAAAAAAAAR/9oACAECAQE/AVf/xAAcEAADAAEFAAAAAAAAAAAAAAAAASERAiIxYXH/2gAIAQEABj8CzwiU3rL6FR6Z6Vn/xAAcEAEAAgIDAQAAAAAAAAAAAAABABEhkTFBUWH/2gAIAQEAAT8hYqsDmpbsDUBE0Si61H+bFDMVtF+s/9oADAMBAAIAAwAAABDr7//EABURAQEAAAAAAAAAAAAAAAAAAAEQ/9oACAEDAQE/EAj/xAAVEQEBAAAAAAAAAAAAAAAAAAAQIf/aAAgBAgEBPxCD/8QAHRABAQABBAMAAAAAAAAAAAAAAREAIUFxgTFhof/aAAgBAQABPxCdrlbbWEN8a6s3v0MTAlAJbCbcvsxJWUAHRxPGCKmlysGddZGLEqLn/9k=","aspectRatio":1.592920353982301,"src":"/static/080606f69c5a5671d4689cd6a57cdf1e/7f945/andrew-buchanan-1404154-unsplash-optimized.jpg","srcSet":"/static/080606f69c5a5671d4689cd6a57cdf1e/e2788/andrew-buchanan-1404154-unsplash-optimized.jpg 360w,\n/static/080606f69c5a5671d4689cd6a57cdf1e/7d509/andrew-buchanan-1404154-unsplash-optimized.jpg 720w,\n/static/080606f69c5a5671d4689cd6a57cdf1e/7f945/andrew-buchanan-1404154-unsplash-optimized.jpg 1440w,\n/static/080606f69c5a5671d4689cd6a57cdf1e/47dad/andrew-buchanan-1404154-unsplash-optimized.jpg 2160w,\n/static/080606f69c5a5671d4689cd6a57cdf1e/af56c/andrew-buchanan-1404154-unsplash-optimized.jpg 2880w,\n/static/080606f69c5a5671d4689cd6a57cdf1e/b85df/andrew-buchanan-1404154-unsplash-optimized.jpg 3500w","sizes":"(max-width: 1440px) 100vw, 1440px"}}},"coverAuthor":"Andrew Buchanan","coverOriginalUrl":"https://unsplash.com/photos/UYJL-k9bkAY?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText","keywords":["emberjs","dependency injection"],"published":true}}},"pageContext":{"slug":"/2016-06-28-component-dependency-injection-in-ember-js/","previous":{"fields":{"slug":"/2016-06-17-bringing-ecto-changesets-into-ember-js/"},"frontmatter":{"title":"Bringing Ecto Changesets into Ember.js"}},"next":{"fields":{"slug":"/2016-08-12-rise-from-the-ashes-incremental-apis-with-phoenix/"},"frontmatter":{"title":"Rise From the Ashes ‚Äî Incremental APIs With Phoenix"}}}},"staticQueryHashes":["3009088689","63159454"]}