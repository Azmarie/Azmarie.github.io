{"componentChunkName":"component---src-templates-blog-post-tsx","path":"/2015-04-17-creating-an-ember-cli-addon-detecting-ember-js-components-entering-or-leaving-the-viewport/","result":{"data":{"site":{"siteMetadata":{"title":"no.lol","author":"Azmarie Wang"}},"markdownRemark":{"id":"219f19f0-853b-54a5-ab8d-7fe3553e2d30","excerpt":"I wrote a post last year about how I made an Ember Mixin that would let Ember Components or Views know if their DOM element had entered or left the viewport. If…","html":"<p>I <a href=\"https://medium.com/delightful-ui-for-ember-apps/ember-js-detecting-if-a-dom-element-is-in-the-viewport-eafcc77a6f86\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">wrote a post</a> last year about how I made an Ember Mixin that would let Ember Components or Views know if their DOM element had entered or left the viewport. If you’re unfamiliar with the <a href=\"https://developer.mozilla.org/en-US/docs/Web/API/Element/getBoundingClientRect\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"><code class=\"language-text\">getBoundingClientRect</code></a> API or the approach in general (for determining if an element is in the viewport), please have a read of that post first!</p>\n<p>This time, I want to talk about how I improved the original Mixin to use the <a href=\"https://developer.mozilla.org/en-US/docs/Web/API/window/requestAnimationFrame\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"><code class=\"language-text\">requestAnimationFrame</code></a>  API for improved performance at close to 60FPS, as well as to go through the process of creating a simple <a href=\"http://www.ember-cli.com/#developing-addons-and-blueprints\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">ember-cli addon</a>. Because certain browsers (mainly IE) don’t support rAF, we’ll also setup an automatic fallback to using the Ember run loop method I used in my previous post.</p>\n<p>Let’s get started!</p>\n<h3 id=\"demo-app\" style=\"position:relative;\"><a href=\"#demo-app\" aria-label=\"demo app permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Demo App</h3>\n<p><img src=\"https://cdn-images-1.medium.com/max/800/1*9WZqJfpL4daIEBJiufTolQ.png\"></p>\n<p>Featuring Brian from DockYard ☺</p>\n<p>I made a simple <a href=\"http://development.ember-in-viewport-demo.divshot.io/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">demo app</a> to demonstrate how you might use the Mixin. The goal for this addon was to allow you to easily style or do something with Components/Views when they enter or leave the viewport. For example, you could easily use this Mixin to build a lazy loader for images, or even for triggering animations. Using this Mixin, you won’t need to bring a jQuery plugin and can instead rely on a highly performant ember-cli addon.</p>\n<h3 id=\"installing-the-addon\" style=\"position:relative;\"><a href=\"#installing-the-addon\" aria-label=\"installing the addon permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Installing the addon</h3>\n<p>If you’re using ember-cli and want to use the addon, you can install it with:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ ember install ember-in-viewport</code></pre></div>\n<p>The source for the addon is available at <a href=\"https://github.com/dockyard/ember-in-viewport\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">dockyard/ember-in-viewport</a>.</p>\n<h3 id=\"creating-your-first-ember-cli-addon\" style=\"position:relative;\"><a href=\"#creating-your-first-ember-cli-addon\" aria-label=\"creating your first ember cli addon permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Creating your first ember-cli addon</h3>\n<p>I’m going to walk through this post as if I was creating the <a href=\"https://github.com/dockyard/ember-in-viewport\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">ember-in-viewport</a> addon, so I’ll be using that name from here on.</p>\n<p>With ember-cli, creating a new addon is just one command away:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ ember addon ember-in-viewport</code></pre></div>\n<p>This generates a new folder structure with the same name as your addon. Before we dive into the addon logic, let’s get a few housekeeping items out of the way.</p>\n<h4 id=\"updating-manifests\" style=\"position:relative;\"><a href=\"#updating-manifests\" aria-label=\"updating manifests permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Updating manifests</h4>\n<p><a href=\"https://docs.npmjs.com/files/package.json\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">package.json</a> is the manifest for your ember-cli addon that does many things with npm. Because this is quite basic, I won’t go into any details here, but you’ll want to update your addon’s <em>name</em>, <em>description</em>, <em>repository</em>, <em>author</em> <em>name</em> and <em>keywords</em> as relevant to your addon. If you care at all about scores on <a href=\"http://emberobserver.com/addons/ember-cli-flash\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Ember Observer</a>, you’ll want to make sure these are filled out correctly because they do affect scores! They also help with finding your addon on npm, so it doesn’t hurt to fill these out from the start.</p>\n<p>For this addon, since we’re not using ember-data, we’re going to delete that line in <a href=\"https://github.com/dockyard/ember-in-viewport/blob/0.2.1/package.json\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">package.json</a> as well as <a href=\"https://github.com/dockyard/ember-in-viewport/blob/0.2.1/bower.json\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">bower.json</a>.</p>\n<h4 id=\"adding-an-ember-try-config\" style=\"position:relative;\"><a href=\"#adding-an-ember-try-config\" aria-label=\"adding an ember try config permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Adding an ember-try config</h4>\n<p><a href=\"https://github.com/kategengler/ember-try\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">ember-try</a> is a wonderful ember-cli addon by <a href=\"https://twitter.com/katiegengler\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">@katiegengler</a> that helps you test against multiple bower dependencies such as ember and ember-data. This means you’ll be able to test your addon to verify if it works on other versions, which is a nice thing to do as an addon author! For ember-in-viewport, we <a href=\"https://github.com/dockyard/ember-in-viewport/blob/0.2.1/config/ember-try.js\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">test against ember 1.11.1, release, beta and canary channels</a>.</p>\n<p>With that out of the way, we can start writing the improved logic for the addon.</p>\n<h3 id=\"rewriting-the-in-viewport-mixin\" style=\"position:relative;\"><a href=\"#rewriting-the-in-viewport-mixin\" aria-label=\"rewriting the in viewport mixin permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Rewriting the In Viewport Mixin</h3>\n<p>The Mixin still uses the <a href=\"https://medium.com/delightful-ui-for-ember-apps/ember-js-detecting-if-a-dom-element-is-in-the-viewport-eafcc77a6f86\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">same method</a> for determining if a DOM element is in the viewport, using <a href=\"https://developer.mozilla.org/en-US/docs/Web/API/Element.getBoundingClientRect\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">getBoundingClientRect</a> and the window’s <a href=\"https://developer.mozilla.org/en-US/docs/Web/API/Window.innerHeight\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">innerHeight</a> and <a href=\"https://developer.mozilla.org/en-US/docs/Web/API/Window.innerWidth\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">innerWidth</a>.</p>\n<p>First, let’s create a new Mixin using ember-cli:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ ember g mixin in-viewport</code></pre></div>\n<p>This creates the appropriate files inside of <strong>/addon</strong>, which is the main folder for your addon’s logic. This folder won’t be merged with the consuming ember application’s tree (unlike the <strong>/app</strong> folder). For this addon, we want our users to import the mixin directly from the addon itself, so we’ll delete the folder that was generated inside of <strong>/app</strong>, and update the generated tests to import the right file.</p>\n<h4 id=\"importing-modules-and-utils\" style=\"position:relative;\"><a href=\"#importing-modules-and-utils\" aria-label=\"importing modules and utils permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Importing modules and utils</h4>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">import</span> Ember <span class=\"token keyword\">from</span> <span class=\"token string\">'ember'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> canUseDOM <span class=\"token keyword\">from</span> <span class=\"token string\">'ember-in-viewport/utils/can-use-dom'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> canUseRAF <span class=\"token keyword\">from</span> <span class=\"token string\">'ember-in-viewport/utils/can-use-raf'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> isInViewport <span class=\"token keyword\">from</span> <span class=\"token string\">'ember-in-viewport/utils/is-in-viewport'</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Inside of <a href=\"https://github.com/dockyard/ember-in-viewport/blob/0.2.1/addon%2Fmixins%2Fin-viewport.js\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">addons/mixins/in-viewport.js</a>, we’ll import the modules that the mixin requires. The <a href=\"https://github.com/dockyard/ember-in-viewport/blob/0.2.1/addon%2Futils%2Fcan-use-dom.js\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">canUseDOM</a> and <a href=\"https://github.com/dockyard/ember-in-viewport/blob/0.2.1/addon%2Futils%2Fcan-use-raf.js\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">canUseRAF</a> modules are simple utility files that help us determine whether or not a DOM is available (this is particularly important for running PhantomJS tests and FastBoot/server side rendering) and whether or not the user’s browser supports the <a href=\"https://developer.mozilla.org/en-US/docs/Web/API/window/requestAnimationFrame\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">requestAnimationFrame</a> API.</p>\n<p>To generate a new utility file:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ ember g util can-use-dom</code></pre></div>\n<p>Again, we don’t want these files inside our users’ app trees, so we’ll delete the folders generated inside of <strong>/app.</strong></p>\n<h4 id=\"updating-the-is-in-viewport-logic\" style=\"position:relative;\"><a href=\"#updating-the-is-in-viewport-logic\" aria-label=\"updating the is in viewport logic permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Updating the Is In Viewport logic</h4>\n<p>The <a href=\"https://github.com/dockyard/ember-in-viewport/blob/0.2.1/addon%2Futils%2Fis-in-viewport.js\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">method for calculating</a> whether or not a DOM element is in the viewport remains mostly unchanged, except with the addition of a new ‘tolerance’ argument.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">import</span> Ember <span class=\"token keyword\">from</span> <span class=\"token string\">'ember'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> merge <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> Ember<span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> defaultTolerance <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  top    <span class=\"token operator\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>\n  left   <span class=\"token operator\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>\n  bottom <span class=\"token operator\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>\n  right  <span class=\"token operator\">:</span> <span class=\"token number\">0</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token keyword\">function</span> <span class=\"token function\">isInViewport</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">boundingClientRect<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> height<span class=\"token operator\">=</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> width<span class=\"token operator\">=</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> tolerance<span class=\"token operator\">=</span>defaultTolerance</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> top<span class=\"token punctuation\">,</span> left<span class=\"token punctuation\">,</span> bottom<span class=\"token punctuation\">,</span> right <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> boundingClientRect<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> tolerances <span class=\"token operator\">=</span> <span class=\"token function\">merge</span><span class=\"token punctuation\">(</span>defaultTolerance<span class=\"token punctuation\">,</span> tolerance<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">let</span> <span class=\"token punctuation\">{</span>\n    top    <span class=\"token operator\">:</span> topTolerance<span class=\"token punctuation\">,</span>\n    left   <span class=\"token operator\">:</span> leftTolerance<span class=\"token punctuation\">,</span>\n    bottom <span class=\"token operator\">:</span> bottomTolerance<span class=\"token punctuation\">,</span>\n    right  <span class=\"token operator\">:</span> rightTolerance\n  <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> tolerances<span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token punctuation\">(</span>top <span class=\"token operator\">+</span> topTolerance<span class=\"token punctuation\">)</span>       <span class=\"token operator\">>=</span> <span class=\"token number\">0</span> <span class=\"token operator\">&amp;&amp;</span>\n    <span class=\"token punctuation\">(</span>left <span class=\"token operator\">+</span> leftTolerance<span class=\"token punctuation\">)</span>     <span class=\"token operator\">>=</span> <span class=\"token number\">0</span> <span class=\"token operator\">&amp;&amp;</span>\n    <span class=\"token punctuation\">(</span>bottom <span class=\"token operator\">-</span> bottomTolerance<span class=\"token punctuation\">)</span> <span class=\"token operator\">&lt;=</span> height <span class=\"token operator\">&amp;&amp;</span>\n    <span class=\"token punctuation\">(</span>right <span class=\"token operator\">-</span> rightTolerance<span class=\"token punctuation\">)</span>   <span class=\"token operator\">&lt;=</span> width\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>With the addition of the tolerance option, addon users can relax how precise the check is. When set to 0, the Mixin only considers an element inside the viewport when it is completely visible inside of the viewport.</p>\n<h4 id=\"setting-up-the-class-variables\" style=\"position:relative;\"><a href=\"#setting-up-the-class-variables\" aria-label=\"setting up the class variables permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Setting up the Class variables</h4>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span>\n  get<span class=\"token punctuation\">,</span>\n  set<span class=\"token punctuation\">,</span>\n  setProperties<span class=\"token punctuation\">,</span>\n  computed<span class=\"token punctuation\">,</span>\n  run<span class=\"token punctuation\">,</span>\n  on<span class=\"token punctuation\">,</span>\n  $<span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> Ember<span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span>\n  scheduleOnce<span class=\"token punctuation\">,</span>\n  debounce<span class=\"token punctuation\">,</span>\n  bind<span class=\"token punctuation\">,</span>\n  next\n<span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> run<span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> not <span class=\"token punctuation\">}</span>     <span class=\"token operator\">=</span> computed<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> forEach <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> Ember<span class=\"token punctuation\">.</span>EnumerableUtils<span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> listeners <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>\n  <span class=\"token punctuation\">{</span> context<span class=\"token operator\">:</span> window<span class=\"token punctuation\">,</span>   event<span class=\"token operator\">:</span> <span class=\"token string\">'scroll.scrollable'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">{</span> context<span class=\"token operator\">:</span> window<span class=\"token punctuation\">,</span>   event<span class=\"token operator\">:</span> <span class=\"token string\">'resize.resizable'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">{</span> context<span class=\"token operator\">:</span> document<span class=\"token punctuation\">,</span> event<span class=\"token operator\">:</span> <span class=\"token string\">'touchmove.scrollable'</span> <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">let</span> rAFIDS <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>If you haven’t had the chance to use <a href=\"https://babeljs.io/docs/learn-es6/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">ES2015 features</a>, now’s a good time to learn, since ember-cli-babel has been shipped with ember-cli by default for a while now. Here, we’re destructuring certain methods from Ember, as well as setting up an array of listeners we want to register. I also declare a mutable variable rAFIDS with <strong>let</strong> — I’ll be using this object to store the ID that’s returned by the requestAnimationFrame function so that we can cancel it later.</p>\n<p>Something interesting to note is that these variables are actually shared by all instances of the Mixin. This means if we stored the rAF ID in that variable, it will be overwritten by other instances of the Components that are being watched by the Mixin. So instead, we’ll store each rAF ID as a key (the element ID for the Component) inside of an object. More on that later.</p>\n<h4 id=\"initial-state\" style=\"position:relative;\"><a href=\"#initial-state\" aria-label=\"initial state permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Initial state</h4>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">_setInitialState<span class=\"token operator\">:</span> <span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'init'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">setProperties</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n    $viewportCachedEl   <span class=\"token operator\">:</span> <span class=\"token keyword\">undefined</span><span class=\"token punctuation\">,</span>\n    viewportUseRAF      <span class=\"token operator\">:</span> <span class=\"token function\">canUseRAF</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    viewportEntered     <span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span>\n    viewportSpy         <span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span>\n    viewportRefreshRate <span class=\"token operator\">:</span> <span class=\"token number\">100</span><span class=\"token punctuation\">,</span>\n    viewportTolerance   <span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      top    <span class=\"token operator\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>\n      left   <span class=\"token operator\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>\n      bottom <span class=\"token operator\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>\n      right  <span class=\"token operator\">:</span> <span class=\"token number\">0</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></code></pre></div>\n<p>We’ll need to setup some initial values for our Mixin’s state. We do this when the Object the Mixin is mixed into is instantiated, by setting some properties on <em>init</em>. This is because <a href=\"http://emberjs.com/api/classes/Ember.Mixin.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Mixins extend a constructor’s prototype</a>, so certain properties will be shared amongst objects that implement the Mixin — and in our case, we want these to be unique to each instance.</p>\n<p>Here, we’re also going to make use of our utility function <strong>canUseRAF</strong> to let the Mixin know whether to use requestAnimationFrame or fallback to the Ember run loop.</p>\n<h4 id=\"read-only-computed-properties\" style=\"position:relative;\"><a href=\"#read-only-computed-properties\" aria-label=\"read only computed properties permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Read only computed properties</h4>\n<p>For convenience, we’ll add a ‘<strong>viewportExited</strong>’ computed property (c.f. ‘viewportEntered’) that our addon users can use. Setting this up is simple:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">viewportExited<span class=\"token operator\">:</span> <span class=\"token function\">not</span><span class=\"token punctuation\">(</span><span class=\"token string\">'viewportEntered'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">readOnly</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></code></pre></div>\n<p>We’ll also make this computed property <a href=\"http://emberjs.com/api/classes/Ember.ComputedProperty.html#method_readOnly\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">read only</a>, because it doesn’t make sense for the addon user to set this manually.</p>\n<h4 id=\"setting-up-the-dom-element-rendered-by-the-component\" style=\"position:relative;\"><a href=\"#setting-up-the-dom-element-rendered-by-the-component\" aria-label=\"setting up the dom element rendered by the component permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Setting up the DOM element rendered by the component</h4>\n<p>When the DOM element is inserted into the DOM, we’ll need to setup a few things:</p>\n<ol>\n<li>The initial check on render to see if the element is immediately in view</li>\n<li>Setting up an observer if we’re not spying on the element</li>\n<li>Calling the recursive requestAnimationFrame method</li>\n<li>Setting up and removing event listeners if we are spying on the element</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">_setupElement<span class=\"token operator\">:</span> <span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'didInsertElement'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>canUseDOM<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span> <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">const</span> viewportUseRAF <span class=\"token operator\">=</span> <span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'viewportUseRAF'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">_setInitialViewport</span><span class=\"token punctuation\">(</span>window<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">_addObserverIfNotSpying</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">_setViewportEntered</span><span class=\"token punctuation\">(</span>window<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>viewportUseRAF<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span>listeners<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">listener</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> context<span class=\"token punctuation\">,</span> event <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> listener<span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">_bindListeners</span><span class=\"token punctuation\">(</span>context<span class=\"token punctuation\">,</span> event<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></code></pre></div>\n<h4 id=\"checking-if-the-dom-element-is-immediately-in-view\" style=\"position:relative;\"><a href=\"#checking-if-the-dom-element-is-immediately-in-view\" aria-label=\"checking if the dom element is immediately in view permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Checking if the DOM element is immediately in view</h4>\n<p>After the element has been rendered into the DOM, we want to immediately check if it’s visible. This calls the <strong>_setViewportEntered</strong> method in the afterRender queue of the Ember run loop.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token function\">_setInitialViewport</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">context<span class=\"token operator\">=</span><span class=\"token keyword\">null</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  Ember<span class=\"token punctuation\">.</span><span class=\"token function\">assert</span><span class=\"token punctuation\">(</span><span class=\"token string\">'You must pass a valid context to _setInitialViewport'</span><span class=\"token punctuation\">,</span> context<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token function\">scheduleOnce</span><span class=\"token punctuation\">(</span><span class=\"token string\">'afterRender'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">_setViewportEntered</span><span class=\"token punctuation\">(</span>context<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span></code></pre></div>\n<h4 id=\"unbinding-listeners-after-entering-the-viewport\" style=\"position:relative;\"><a href=\"#unbinding-listeners-after-entering-the-viewport\" aria-label=\"unbinding listeners after entering the viewport permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Unbinding listeners after entering the viewport</h4>\n<p>It makes sense for certain use cases to actually stop watching the element after it has entered the viewport at least once. For example, in an image lazy loader, we only want to load the image once, after which it makes sense to clean up listeners to reduce the load on the app. We do that with the <strong>viewportSpy</strong> option.</p>\n<p>Here, we programatically add an <a href=\"http://emberjs.com/api/classes/Ember.Object.html#method_addObserver\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">observer</a> on the <strong>viewportEntered</strong> prop if <strong>viewportSpy</strong> has been set to false by our addon user. The observer itself doesn’t do much — it unbinds listeners and then removes itself.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token function\">_addObserverIfNotSpying</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> viewportSpy <span class=\"token operator\">=</span> <span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'viewportSpy'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>viewportSpy<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">addObserver</span><span class=\"token punctuation\">(</span><span class=\"token string\">'viewportEntered'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>_viewportDidEnter<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n\n<span class=\"token function\">_viewportDidEnter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> viewportEntered <span class=\"token operator\">=</span> <span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'viewportEntered'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> viewportSpy     <span class=\"token operator\">=</span> <span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'viewportSpy'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>viewportSpy <span class=\"token operator\">&amp;&amp;</span> viewportEntered<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">_unbindListeners</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">removeObserver</span><span class=\"token punctuation\">(</span><span class=\"token string\">'viewportEntered'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>_viewportDidEnter<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span></code></pre></div>\n<h4 id=\"setting-up-event-listeners\" style=\"position:relative;\"><a href=\"#setting-up-event-listeners\" aria-label=\"setting up event listeners permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Setting up event listeners</h4>\n<p>Let’s look at binding our event listeners before we take a look at <strong>_setViewportEntered</strong>, the main method for the mixin. We’ll be using the array of listeners we declared earlier at the top of the file, and binding the event to the appropriate context (<em>window</em> or <em>document</em>), like so:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token function\">_bindListeners</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">context<span class=\"token operator\">=</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> event<span class=\"token operator\">=</span><span class=\"token keyword\">null</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  Ember<span class=\"token punctuation\">.</span><span class=\"token function\">assert</span><span class=\"token punctuation\">(</span><span class=\"token string\">'You must pass a valid context to _bindListeners'</span><span class=\"token punctuation\">,</span> context<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  Ember<span class=\"token punctuation\">.</span><span class=\"token function\">assert</span><span class=\"token punctuation\">(</span><span class=\"token string\">'You must pass a valid event to _bindListeners'</span><span class=\"token punctuation\">,</span> event<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">const</span> elementId <span class=\"token operator\">=</span> <span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'elementId'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  Ember<span class=\"token punctuation\">.</span><span class=\"token function\">warn</span><span class=\"token punctuation\">(</span><span class=\"token string\">'No elementId was found on this Object, `viewportSpy` will'</span> <span class=\"token operator\">+</span>\n    <span class=\"token string\">'not work as expected'</span><span class=\"token punctuation\">,</span> elementId<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token function\">$</span><span class=\"token punctuation\">(</span>context<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>event<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">#</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>elementId<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">_scrollHandler</span><span class=\"token punctuation\">(</span>context<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span></code></pre></div>\n<p>Note that we can actually pass the Component’s <a href=\"http://emberjs.com/api/classes/Ember.View.html#property_elementId\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">elementId</a> (the id attribute that is rendered into the DOM) to the event, which will allow us to only unbind the listener for that particular element. If we didn’t do this, all listeners would have been unbound when the first DOM element enters the viewport, which isn’t what we’d expect.</p>\n<h4 id=\"handling-the-event\" style=\"position:relative;\"><a href=\"#handling-the-event\" aria-label=\"handling the event permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Handling the event</h4>\n<p>Now, we can handle the event by debouncing the main method with the <strong>viewportRefreshRate</strong> set by the addon user. I talk about this in my previous post, so please have a read if you’re not sure how debouncing works with the Ember run loop.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token function\">_scrollHandler</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">context<span class=\"token operator\">=</span><span class=\"token keyword\">null</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  Ember<span class=\"token punctuation\">.</span><span class=\"token function\">assert</span><span class=\"token punctuation\">(</span><span class=\"token string\">'You must pass a valid context to _scrollHandler'</span><span class=\"token punctuation\">,</span> context<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">const</span> viewportRefreshRate <span class=\"token operator\">=</span> <span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'viewportRefreshRate'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token function\">debounce</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">_setViewportEntered</span><span class=\"token punctuation\">(</span>context<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> viewportRefreshRate<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span></code></pre></div>\n<h4 id=\"unbinding-listeners\" style=\"position:relative;\"><a href=\"#unbinding-listeners\" aria-label=\"unbinding listeners permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Unbinding listeners</h4>\n<p>When we eventually destroy the Component, we want to make sure we also cleanup after ourselves. We’ll have to remove both event listeners and the recursive requestAnimationFrame call:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token function\">_unbindListeners</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> elementId      <span class=\"token operator\">=</span> <span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'elementId'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> viewportUseRAF <span class=\"token operator\">=</span> <span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'viewportUseRAF'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  Ember<span class=\"token punctuation\">.</span><span class=\"token function\">warn</span><span class=\"token punctuation\">(</span><span class=\"token string\">'No elementId was found on this Object, `viewportSpy` will'</span> <span class=\"token operator\">+</span>\n    <span class=\"token string\">'not work as expected'</span><span class=\"token punctuation\">,</span> elementId<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>viewportUseRAF<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">next</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      window<span class=\"token punctuation\">.</span><span class=\"token function\">cancelAnimationFrame</span><span class=\"token punctuation\">(</span>rAFIDS<span class=\"token punctuation\">[</span>elementId<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      rAFIDS<span class=\"token punctuation\">[</span>elementId<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span>listeners<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">listener</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> context<span class=\"token punctuation\">,</span> event <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> listener<span class=\"token punctuation\">;</span>\n    <span class=\"token function\">$</span><span class=\"token punctuation\">(</span>context<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">off</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>event<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">#</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>elementId<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">_teardown<span class=\"token operator\">:</span> <span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'willDestroyElement'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">_unbindListeners</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></code></pre></div>\n<p>If you recall, the <a href=\"https://developer.mozilla.org/en-US/docs/Web/API/window/requestAnimationFrame\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">requestAnimationFrame</a> function returns an ID that uniquely identifies the entry in the callback list. We can pass this on to <a href=\"https://developer.mozilla.org/en-US/docs/Web/API/Window/cancelAnimationFrame\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">cancelAnimationFrame</a> in order to cancel the infinitely recursive call to the main method. Because we register the Component’s DOM elementId as a key in the rAFIDS object, we can remove the specific rAF call for that single Component. I’ve wrapped the cAF call in an Ember.run.next to avoid a race condition preventing proper cancellation of the rAF recursion that happens occasionally.</p>\n<h4 id=\"updating-the-viewportentered-property\" style=\"position:relative;\"><a href=\"#updating-the-viewportentered-property\" aria-label=\"updating the viewportentered property permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Updating the viewportEntered property</h4>\n<p>Let’s take a look at the main method responsible for setting the ‘<strong>viewportEntered</strong>’ property. This method does two main things:</p>\n<ol>\n<li>Set viewportEntered to true or false</li>\n<li>Fire off the next requestAnimationFrame step</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token function\">_setViewportEntered</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">context<span class=\"token operator\">=</span><span class=\"token keyword\">null</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  Ember<span class=\"token punctuation\">.</span><span class=\"token function\">assert</span><span class=\"token punctuation\">(</span><span class=\"token string\">'You must pass a valid context to _setViewportEntered'</span><span class=\"token punctuation\">,</span> context<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">const</span> $viewportCachedEl <span class=\"token operator\">=</span> <span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'$viewportCachedEl'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> viewportUseRAF    <span class=\"token operator\">=</span> <span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'viewportUseRAF'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> elementId         <span class=\"token operator\">=</span> <span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'elementId'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> tolerance         <span class=\"token operator\">=</span> <span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'viewportTolerance'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> height            <span class=\"token operator\">=</span> <span class=\"token function\">$</span><span class=\"token punctuation\">(</span>context<span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> <span class=\"token function\">$</span><span class=\"token punctuation\">(</span>context<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">height</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> width             <span class=\"token operator\">=</span> <span class=\"token function\">$</span><span class=\"token punctuation\">(</span>context<span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> <span class=\"token function\">$</span><span class=\"token punctuation\">(</span>context<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">width</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>  <span class=\"token operator\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">let</span> boundingClientRect<span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>$viewportCachedEl<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    boundingClientRect <span class=\"token operator\">=</span> $viewportCachedEl<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token function\">getBoundingClientRect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n    boundingClientRect <span class=\"token operator\">=</span> <span class=\"token function\">set</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'$viewportCachedEl'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">$</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token function\">getBoundingClientRect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">const</span> viewportEntered <span class=\"token operator\">=</span> <span class=\"token function\">isInViewport</span><span class=\"token punctuation\">(</span>boundingClientRect<span class=\"token punctuation\">,</span> height<span class=\"token punctuation\">,</span> width<span class=\"token punctuation\">,</span> tolerance<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token function\">set</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'viewportEntered'</span><span class=\"token punctuation\">,</span> viewportEntered<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>$viewportCachedEl <span class=\"token operator\">&amp;&amp;</span> viewportUseRAF<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    rAFIDS<span class=\"token punctuation\">[</span>elementId<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> window<span class=\"token punctuation\">.</span><span class=\"token function\">requestAnimationFrame</span><span class=\"token punctuation\">(</span>\n      <span class=\"token function\">bind</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>_setViewportEntered<span class=\"token punctuation\">,</span> context<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span></code></pre></div>\n<p>As a simple optimization, we can cache the selected DOM element inside the Object as <strong>$viewportCachedEl</strong> so we don’t have call the expensive DOM node selector method every time. Then, we pass the Component’s element properties to the utility we defined earlier, and set the <strong>viewportEntered</strong> property to true or false.</p>\n<p>If requestAnimationFrame is enabled, we call the method again inside of the rAF method, after <a href=\"http://emberjs.com/api/classes/Ember.run.html#method_bind\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">binding it to the correct context</a>. Like <a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function/bind\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Function.prototype.bind()</a>, this creates a new function, that when called, has its <em>this</em> keyword set to the correct value (along with any arguments). With that first call after the element is inserted into the DOM, this fires off an infinitely recursive loop that will only end when we cancel it.</p>\n<p>Hence, we don’t have to setup event listeners when rAF is enabled. And that’s it for the Mixin!</p>\n<h4 id=\"recap\" style=\"position:relative;\"><a href=\"#recap\" aria-label=\"recap permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Recap</h4>\n<p>Basically, the Mixin does one of two things when implemented by a Component or View:</p>\n<ol>\n<li>If rAF is enabled, it sets off an infinitely recursive call to the main method at close to 60FPS (or whatever the user’s monitor refresh rate is), without the use of event listeners. This is then canceled when the Component is destroyed, or if the <strong>viewportSpy</strong> option has been set to false and the Component has already entered the viewport once.</li>\n<li>If not, the Mixin sets up event listeners on the Component’s unique DOM element, and fires the main method whenever the user triggers one of three events (scroll, resize, and touch). Again, the event listeners are removed on destroy and if the <strong>viewportSpy</strong> option is false.</li>\n</ol>\n<h3 id=\"unleashing-your-addon-on-the-ember-community\" style=\"position:relative;\"><a href=\"#unleashing-your-addon-on-the-ember-community\" aria-label=\"unleashing your addon on the ember community permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Unleashing your addon on the Ember community</h3>\n<p>Now that we’re done with the main addon logic, and writing tests (a topic for another post!), we’re ready to release our addon to the world! I typically use <a href=\"http://danielkummer.github.io/git-flow-cheatsheet/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">git flow</a> to manage my repos, and it also helps with the release process using <strong>git flow release.</strong></p>\n<p>At this point, I make sure my readme is written comprehensively to detail how an addon user can use the addon, as well as bump version numbers according to <a href=\"http://semver.org/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">SemVer</a>. <a href=\"https://github.com/dockyard/ember-in-viewport/releases\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">GitHub</a> also has a nice way to keep track of your addon’s different named releases, which I tend to use quite often as a way to keep addon users updated about what’s changed in each version.</p>\n<p>Once your changes have been merged back into <em>master</em>, you can <a href=\"https://gist.github.com/coolaj86/1318304\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">publish your addon</a> up onto npm:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ npm publish</code></pre></div>\n<p>Congrats! You’ve written your first addon☺Now you can obsess over your addon’s score at <a href=\"http://emberobserver.com/addons/ember-in-viewport\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Ember Observer</a>.</p>\n<h3 id=\"thanks-for-reading\" style=\"position:relative;\"><a href=\"#thanks-for-reading\" aria-label=\"thanks for reading permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Thanks for reading!</h3>\n<p>This has been a pretty long post, I hope you’ve learned something. If you’d like to ask any questions, please feel free to send me a <a href=\"http://www.twitter.com/sugarpirate_\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">tweet</a>.</p>\n<p>Some of you might probably know that I’ve recently joined <a href=\"http://www.dockyard.com\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">DockYard</a>. If you’re looking for Ember experts to augment your staff, work on a greenfield project or an existing one, please get in touch!</p>\n<p>Until next time,</p>\n<p>Lauren</p>","timeToRead":15,"fields":{"slug":"/2015-04-17-creating-an-ember-cli-addon-detecting-ember-js-components-entering-or-leaving-the-viewport/"},"frontmatter":{"title":"Creating an Ember CLI addon — Detecting Ember.js Components Entering or Leaving the Viewport","shortDate":"April 17, 2015","longDate":"April 17, 2015, 11:02:16 pm","description":"I wrote a post last year about how I made an Ember Mixin that would let Ember Components or Views know if their DOM element had entered or…","categories":["engineering"],"cover":{"childImageSharp":{"fluid":{"base64":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAANABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAAAAMCBf/EABUBAQEAAAAAAAAAAAAAAAAAAAAB/9oADAMBAAIQAxAAAAHhWhuJiv/EABoQAQADAAMAAAAAAAAAAAAAAAEAAhEDEiH/2gAIAQEAAQUCKqPDcj47O7F1/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPwE//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPwE//8QAGxAAAgEFAAAAAAAAAAAAAAAAAAEQAhEhMUH/2gAIAQEABj8CbXDNMWNx/8QAGhABAAMBAQEAAAAAAAAAAAAAAQARITFhcf/aAAgBAQABPyEALOvIlSD9gUHpLU2x7KaRZERdWf/aAAwDAQACAAMAAAAQCA//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/ED//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/ED//xAAbEAEAAgMBAQAAAAAAAAAAAAABABEhMUFhof/aAAgBAQABPxB8IhZqzR9g9owCLde+kEKkRHjASIYQdrUM8YoVuiIHYtXrP//Z","aspectRatio":1.5,"src":"/static/fd6f7cfb00a4237e4bd6b22663c082fa/7f945/toa-heftiba-1399721-unsplash-optimized.jpg","srcSet":"/static/fd6f7cfb00a4237e4bd6b22663c082fa/e2788/toa-heftiba-1399721-unsplash-optimized.jpg 360w,\n/static/fd6f7cfb00a4237e4bd6b22663c082fa/7d509/toa-heftiba-1399721-unsplash-optimized.jpg 720w,\n/static/fd6f7cfb00a4237e4bd6b22663c082fa/7f945/toa-heftiba-1399721-unsplash-optimized.jpg 1440w,\n/static/fd6f7cfb00a4237e4bd6b22663c082fa/47dad/toa-heftiba-1399721-unsplash-optimized.jpg 2160w,\n/static/fd6f7cfb00a4237e4bd6b22663c082fa/af56c/toa-heftiba-1399721-unsplash-optimized.jpg 2880w,\n/static/fd6f7cfb00a4237e4bd6b22663c082fa/95a62/toa-heftiba-1399721-unsplash-optimized.jpg 3802w","sizes":"(max-width: 1440px) 100vw, 1440px"}}},"coverAuthor":"Toa Heftiba","coverOriginalUrl":"https://unsplash.com/photos/_2HNqkk6FEU?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText","keywords":["emberjs","requestAnimationFrame","ember-in-viewport","in viewport","getBoundingClientRect","ember addons"],"published":true}}},"pageContext":{"slug":"/2015-04-17-creating-an-ember-cli-addon-detecting-ember-js-components-entering-or-leaving-the-viewport/","previous":{"fields":{"slug":"/2015-04-10-the-importance-of-being-experience-first/"},"frontmatter":{"title":"The Importance of Being Experience First"}},"next":{"fields":{"slug":"/2015-06-01-declarative-breadcrumb-navigation-in-ember-js/"},"frontmatter":{"title":"Declarative Breadcrumb Navigation in Ember.js"}}}},"staticQueryHashes":["3009088689","63159454"]}